# Slug命名規則 (WORKSカテゴリ)

本ドキュメントでは、楽曲紹介記事（WORKSカテゴリ）におけるSlug（URL識別子）の命名規則を定義します。10,000件規模のデータを支えるシステムの堅牢性、SEO、およびユーザーの視認性を両立させることを目的とします。

## 1. 基本原則 (Core Principles)

- **言語**: 英語 (Global Unique)
- **形式**: 小文字英数字とハイフン (`a-z0-9-`) のみを使用（kebab-case）。
- **一意性**: グローバルで一意の識別子とします。
- **意味の非局所化**: URLパスの中で意味を完結させ、識別を容易にします。

---

## 2. 楽曲レベルの命名規則 (Work Slug)

基本構造: `{genre}-no-{N}[-op-{N}][-key]` or `{title}`

### 2.1. ジャンル・作品番号形式

固有の愛称を持たない、またはジャンル名で識別される楽曲に適用します。

- **"no" の要否**: `no` を明示することを必須とします。
  - 推奨: `symphony-no-5`
  - 非推奨: `symphony-5` (5曲入りセット等との曖昧さを回避するため)
- **作品番号 (Opus/Catalog)**: 慣習的に識別が必要な場合、または同ジャンル・同番号の別作品がある場合に付与します。
  - 例: `impromptus-op-90`

### 2.2. タイトル形式

「フィガロの結婚」や「くるみ割り人形」など、固有のタイトルが支配的な場合に適用します。

- **英語タイトルを採用**: `marriage-of-figaro`, `nutcracker`

### 2.3. 特殊なケース (WTC等)

バッハの「平均律」のように多作かつ構造が明確なものは、シリーズ名の略称を親Slugとして活用することを許容します。

- **WTC**: `wtc-{book}` (e.g., `wtc-1`)

---

## 3. 子要素・階層構造 (Parts/Movements)

構成要素（楽章、曲集内の1曲など）は、ディレクトリ構造（またはスラッシュ区切りのSlug）で表現します。

基本構造: `{parent}/{index}-{identifier}`

- **インデックス番号 (`index`)**: 楽章順や曲順（1, 2, 3...）を先頭に必須とし、一意性と並び順を担保します。
- **識別子 (`identifier`)**: 内容を想起させる単語（速度記号、副題、調性等）を1つ以上繋ぎます。
- **"no" の排除**: 子要素は親に対する相対的な位置（インデックス）で既に識別可能なため、子Slug内での `no-` は冗長として使用しません。

### 階層Slugの例

| 親要素 (Work)      | 子要素 (Part) | 命名の理由                                                 |
| :----------------- | :------------ | :--------------------------------------------------------- |
| `symphony-no-5`    | `1-allegro`   | 順番と内容を一目で判別可能にする。                         |
| `nutcracker`       | `1-overture`  | 作品全体における位置を示す。                               |
| `wtc-1`            | `1-c-major`   | 「何番目か」はインデックス数字で十分なため、`no-` は排除。 |
| `impromptus-op-90` | `1`           | シンプルに「1曲目」であることを示す。                      |

---

## 4. 運用上のガイドライン

1. **Slug生成の自動化**:
   - `generateSlug(metadata)` ロジックを共通化し、エージェントやシステムが生成するSlugの一貫性を保ちます。
2. **不変性の維持**:
   - Slugは原則として変更しません。変更が必要な場合は、`slug_history` 等を用いてリダイレクト管理を行います。
3. **SEOへの配慮**:
   - 冗長になりすぎず、かつ検索キーワード（Symphony No. 5 等）との親和性が高い形を維持します。
